

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overlapping Overset Grids &mdash; documentación de nekStab - 1.0.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> nekStab
          

          
          </a>

          
            
            
              <div class="version">
                main
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adapting.html">Adapting your case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adapting.html#programming-best-practices">Programming best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sourcecode.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_log.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_log.html#changelog-on-nek5000">Changelog on Nek5000</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nekStab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Overlapping Overset Grids</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ricardofrantz/nekStabDoc/blob/master/docs/NekDoc/tutorials/neknek.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="overlapping-overset-grids">
<span id="neknek"></span><h1>Overlapping Overset Grids<a class="headerlink" href="#overlapping-overset-grids" title="Enlace permanente a este encabezado">¶</a></h1>
<p>This tutorial will describe how to run a case with two overlapping meshes (NekNek) from scratch.
We illustrate this by using the Periodic hill case shown above.
If you are not familiar with Nek5000, we strongly recommend you begin with the Periodic hill first!</p>
<p>The three key steps to running a case with NekNek are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Setting up the mesh with appropriate boundary conditions for the overlapping interface.</p></li>
<li><p>Specifying parameters to control stability and accuracy for the overlapping-Schwarz iterations.</p></li>
<li><p>Modifying <code class="docutils literal notranslate"><span class="pre">userbc</span></code> to read Dirichlet boundary data for the overlapping interfaces.</p></li>
</ol>
</div></blockquote>
<section id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Enlace permanente a este encabezado">¶</a></h2>
<p>The pre-processing steps for a NekNek calculation differ from a mono-domain Nek5000 calculation only in terms of ensuring that the appropriate boundary condition <code class="docutils literal notranslate"><span class="pre">int</span></code> is specified at the overlapping interface.
This boundary condition serves as the flag to let the solver know that Dirichlet data for these boundary conditions must come from interpolation of the data in the overlapping mesh.</p>
</section>
<section id="mesh-generation">
<h2>Mesh generation<a class="headerlink" href="#mesh-generation" title="Enlace permanente a este encabezado">¶</a></h2>
<p>In this tutorial, we generate two meshes to span the entire domain, an upper and a lower mesh.
The lower mesh is generated by genbox with the following input file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-2                     spatial dimension (will create box.re2)
1                      number of fields
#
#    comments: two dimensional periodic hill
#
#========================================================
#
Box                                       hillp
-22 5                                     Nelx  Nely
0.0 9.0 1.                                x0 x1 ratio
0.0 0.1 0.25 0.5 1.5 2.5                  y0 y1 ratio
P  ,P  ,W  ,int                           BC&#39;s:  (cbx0, cbx1, cby0, cby1)
</pre></div>
</div>
<p>and the upper mesh is generated by genbox with the following input file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-2                     spatial dimension (will create box.re2)
1                      number of fields
#
#    comments: two dimensional periodic hill
#
#========================================================
#
Box                                       hillp
-21 3                                     Nelx  Nely
0.0 9.0 1.                                x0 x1 ratio
2.25 2.75 2.9 3.0     y0 y1 ratio
P  ,P  ,int,W                             BC&#39;s:  (cbx0, cbx1, cby0, cby1)
</pre></div>
</div>
<p>Note: the lower domain spans <span class="math notranslate nohighlight">\(y \in [0,2.5]\)</span> and the upper domain spans <span class="math notranslate nohighlight">\(y \in [2.25,3]\)</span>. We also use <code class="docutils literal notranslate"><span class="pre">int</span></code> for the boundary surfaces that overlap the other domain.</p>
<p>Now the meshes can be generated by running genbox for each of these cases to obtain <code class="docutils literal notranslate"><span class="pre">upper.re2</span></code> and <code class="docutils literal notranslate"><span class="pre">lower.re2</span></code>.</p>
</section>
<section id="usr-file">
<h2>usr file<a class="headerlink" href="#usr-file" title="Enlace permanente a este encabezado">¶</a></h2>
<p>As for the mono-domain periodic hill case, we start by copying the template to our case directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp $HOME/Nek5000/core/zero.usr hillpnn.usr
</pre></div>
</div>
<section id="modify-mesh-and-add-forcing-to-the-flow">
<h3>Modify mesh and add forcing to the flow<a class="headerlink" href="#modify-mesh-and-add-forcing-to-the-flow" title="Enlace permanente a este encabezado">¶</a></h3>
<p>As for the mono-domain periodic hill case, we modify the mesh in usrdat2 as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">usrdat2</span>

<span class="k">implicit none</span>

<span class="k">include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>

<span class="kt">integer </span><span class="n">ntot</span>
<span class="kt">real </span><span class="n">sa</span><span class="p">,</span><span class="n">sb</span><span class="p">,</span><span class="n">sc</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">argx</span><span class="p">,</span><span class="n">A1</span>

<span class="n">ntot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nx1</span><span class="o">*</span><span class="n">ny1</span><span class="o">*</span><span class="n">nz1</span><span class="o">*</span><span class="n">nelt</span>

<span class="n">sa</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">4.5</span>
<span class="n">sb</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">3.5</span>
<span class="n">sc</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="mi">6</span>

<span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ntot</span>
<span class="w">   </span><span class="n">xx</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">xm1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">   </span><span class="n">argx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sb</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">xx</span><span class="o">-</span><span class="n">sa</span><span class="p">)</span><span class="o">-</span><span class="n">sb</span><span class="p">)</span>
<span class="w">   </span><span class="n">A1</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sc</span><span class="o">*</span><span class="nb">tanh</span><span class="p">(</span><span class="n">argx</span><span class="p">)</span>
<span class="w">   </span><span class="n">ym1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ym1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">ym1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">A1</span>
<span class="k">enddo</span>

<span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
<figure class="align-center" id="id1">
<span id="fig-hillnn-mesh"></span><img alt="neknek_mesh" src="../../_images/hillnn_mesh.png" />
<figcaption>
<p><span class="caption-text">Modified box mesh graded</span><a class="headerlink" href="#id1" title="Enlace permanente a esta imagen">¶</a></p>
</figcaption>
</figure>
<p>Currently, applying a constant mass flux with <code class="docutils literal notranslate"><span class="pre">param(54)</span></code> and <code class="docutils literal notranslate"><span class="pre">param(55)</span></code> is <strong>not</strong> supported with overlapping overset grids.
For this case, we drive the flow using a constant acceleration term in userf as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="k">subroutine </span><span class="n">userf</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set acceleration term</span>
<span class="c">!</span>
<span class="c">!     Note: this is an acceleration term, NOT a force!</span>
<span class="c">!     Thus, ffx will subsequently be multiplied by rho(x,t).</span>
<span class="c">!</span>
<span class="w">     </span><span class="k">implicit none</span>

<span class="k">     </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span>

<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="w">     </span><span class="kt">integer </span><span class="n">e</span>
<span class="c">!    e = gllel(eg)</span>

<span class="w">     </span><span class="n">ffx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.052</span>
<span class="w">     </span><span class="n">ffy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">     </span><span class="n">ffz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="w">     </span><span class="k">return</span>
<span class="k">     end</span>
</pre></div>
</div>
</section>
<section id="specify-neknek-parameters">
<h3>Specify NekNek parameters<a class="headerlink" href="#specify-neknek-parameters" title="Enlace permanente a este encabezado">¶</a></h3>
<p>In usrdat, we  specify the number of Schwarz-like iterations and extrapolation order for the boundary conditions of the overlapping interface.
These parameters impact the stability and accuracy of the calculation.
This is done as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">usrdat</span><span class="p">()</span><span class="w">   </span><span class="c">! This routine to modify element vertices</span>

<span class="k">implicit none</span>

<span class="k">include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKNEK&#39;</span>

<span class="n">ngeom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="n">ninter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here we do 4 sub-iterations ($ngeom=5$) at each time-step between the two meshes, and the temporal extrapolation order ($ninter$) is 2.</p>
</section>
<section id="initial-boundary-conditions">
<h3>Initial &amp; boundary conditions<a class="headerlink" href="#initial-boundary-conditions" title="Enlace permanente a este encabezado">¶</a></h3>
<p>The next step is to specify the initial conditions.
This can be done in the subroutine <code class="docutils literal notranslate"><span class="pre">useric</span></code> as follows:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">useric</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ieg</span><span class="p">)</span>

<span class="k">implicit none</span>

<span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span>

<span class="k">include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="n">ux</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">uy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="n">uz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Next we modify userbc to read the boundary conditions, interpolated from overlapping domains, as follows:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="k">subroutine </span><span class="n">userbc</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set up boundary conditions</span>
<span class="c">!</span>
<span class="c">!     NOTE ::: This subroutine MAY NOT be called by every process</span>
<span class="c">!</span>
<span class="w">     </span><span class="k">implicit none</span>

<span class="k">     </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">eg</span>

<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>
<span class="w">     </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKNEK&#39;</span>

<span class="w">     </span><span class="n">ie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gllel</span><span class="p">(</span><span class="n">eg</span><span class="p">)</span>

<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imask</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ie</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      </span><span class="n">ux</span><span class="o">=</span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uy</span><span class="o">=</span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uz</span><span class="o">=</span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">temp</span><span class="o">=</span><span class="mf">0.0</span>
<span class="w">     </span><span class="k">else</span>
<span class="k">      </span><span class="n">ux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valint</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="n">uy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valint</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="n">uz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valint</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfld_neknek</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valint</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">ldim</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="w">     </span><span class="k">end if</span>

<span class="k">     return</span>
<span class="k">     end</span>
</pre></div>
</div>
</section>
</section>
<section id="control-parameters">
<h2>Control parameters<a class="headerlink" href="#control-parameters" title="Enlace permanente a este encabezado">¶</a></h2>
<p>The control parameters for this case are the same as that for the mono-domain periodic hill case.
Create two files called <code class="docutils literal notranslate"><span class="pre">lower.par</span></code> and <code class="docutils literal notranslate"><span class="pre">upper.par</span></code>, and type in each the following:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># nek parameter file</span>
<span class="c1">#</span>
<span class="k">[GENERAL]</span>
<span class="na">stopAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">endTime</span>
<span class="na">endTime</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">200</span>

<span class="na">variableDT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span>
<span class="na">targetCFL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.4</span>
<span class="na">timeStepper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">bdf2</span>

<span class="na">writeControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">runTime</span>
<span class="na">writeInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">20</span>

<span class="k">[PROBLEMTYPE]</span>
<span class="na">equation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">incompNS</span>

<span class="k">[PRESSURE]</span>
<span class="na">residualTol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1e-5</span>
<span class="na">residualProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span>

<span class="k">[VELOCITY]</span>
<span class="na">residualTol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1e-8</span>
<span class="na">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
<span class="na">viscosity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-100</span>
</pre></div>
</div>
</section>
<section id="size-file">
<h2>SIZE file<a class="headerlink" href="#size-file" title="Enlace permanente a este encabezado">¶</a></h2>
<p>The static memory layout of Nek5000 requires the user to set some solver parameters through a so called <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file.
Typically it’s a good idea to start from our template.
Copy the <code class="docutils literal notranslate"><span class="pre">SIZE.template</span></code> file from the core directory and rename it <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> in the working directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp $HOME/Nek5000/core/SIZE.template SIZE
</pre></div>
</div>
<p>Then, adjust the following parameters</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>

<span class="c">! BASIC</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">ldim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lx1</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lxd</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lx2</span><span class="o">=</span><span class="n">lx1</span><span class="p">)</span>

<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lelg</span><span class="o">=</span><span class="mi">22</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lpmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lpmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">ldimt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c">! OPTIONAL</span>
<span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">nsessmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">...</span>
</pre></div>
</div>
<p>For this tutorial we have set our polynomial order to be <span class="math notranslate nohighlight">\(N=7\)</span> - this is defined in the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file above as <code class="docutils literal notranslate"><span class="pre">lx1=8</span></code> which indices that there are 8 points in each spatial dimension of every element.
Additional details on the parameters in the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file are given <a class="reference internal" href="../problem_setup/case_files.html#case-files-size"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Enlace permanente a este encabezado">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">hillpnn.usr</span></code>, and <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> files created, we are now ready to compile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">makenek</span> <span class="n">hillpnn</span>
</pre></div>
</div>
<p>If all works properly, upon compilation the executable <code class="docutils literal notranslate"><span class="pre">nek5000</span></code> will be generated.</p>
</section>
<section id="running-the-case">
<h2>Running the case<a class="headerlink" href="#running-the-case" title="Enlace permanente a este encabezado">¶</a></h2>
<p>First we need to run our domain paritioning tool</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>genmap
</pre></div>
</div>
<p>On input specify <code class="docutils literal notranslate"><span class="pre">lower</span></code> as your casename and press enter to use the default tolerance.
This step will produce <code class="docutils literal notranslate"><span class="pre">lower.ma2</span></code> which needs to be generated only once.
Next do the same for the upper mesh to generate <code class="docutils literal notranslate"><span class="pre">upper.ma2</span></code>.</p>
<p>Now you are all set, just run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>neknekb<span class="w"> </span>lower<span class="w"> </span>upper<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<p>to launch an MPI jobs on your local machine using 4 ranks. The output will be redirected to <code class="docutils literal notranslate"><span class="pre">logfile</span></code>.</p>
</section>
<section id="post-processing-the-results">
<h2>Post-processing the results<a class="headerlink" href="#post-processing-the-results" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Using Visit, the user can post-process the results.</p>
<figure class="align-center" id="id2">
<span id="fig-hillnn-flow"></span><img alt="hillnn_flow" src="../../_images/hillnn_result.png" />
<figcaption>
<p><span class="caption-text">Steady-State flow field visualized in Visit/Paraview. Vectors represent velocity. Colors represent velocity magnitude. Note, velocity vectors are equal size and not scaled by magnitude.</span><a class="headerlink" href="#id2" title="Enlace permanente a esta imagen">¶</a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Ricardo Frantz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: main
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
        
          
          <dd><a href="/nekStabDoc/en/main/">en</a></dd>
          
        
           <strong> 
          <dd><a href="/nekStabDoc/es/main/">es</a></dd>
           </strong> 
        
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
           <strong> 
          <dd><a href="/nekStabDoc/es/main/">main</a></dd>
           </strong> 
        
      </dl>
      
      
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="/nekStabDoc/es/main/nekStab-docs_es_main.pdf">pdf</a></dd>
        
          <dd><a href="/nekStabDoc/es/main/nekStab-docs_es_main.epub">epub</a></dd>
        
      </dl>
      
      
      <hr/>
      <a href="https://tech.michaelaltfield.net/2020/07/18/sphinx-rtd-github-pages-1/">Continuous Documentation</a> hosting provided by <a href="https://pages.github.com/">GitHub Pages</a>.
 
    </div>
  </div>

 

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>