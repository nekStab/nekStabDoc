

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conjugate Heat Transfer &mdash; nekStab 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> nekStab
          

          
          </a>

          
            
            
              <div class="version">
                main
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adapting.html">Adapting your case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adapting.html#programming-best-practices">Programming best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sourcecode.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_log.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_log.html#changelog-on-nek5000">Changelog on Nek5000</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nekStab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Conjugate Heat Transfer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ricardofrantz/nekStabDoc/blob/master/docs/NekDoc/tutorials/conjht.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="conjugate-heat-transfer">
<span id="conjht"></span><h1>Conjugate Heat Transfer<a class="headerlink" href="#conjugate-heat-transfer" title="Permalink to this heading">¶</a></h1>
<p>In this tutorial, we want to simulate a simple 2D Rayleigh-Benard convection (RBC) flow using <em>Nek5000’s</em> conjugate heat transfer capability.
The conjugate heat transfer capability solves the energy equation across both solid and liquid subdomains.
in the case of RBC, this provides a continuous temperature profile through horizontal walls of finite thickness.
The modeled case corresponds to a simplified version of simulations performed by Foroozhani et al. <a class="reference internal" href="../references.html#foroozani2021" id="id1"><span>[Foroozani2021]</span></a>.</p>
<p>If you are not familiar with <em>Nek5000</em>, we strongly recommend that you begin with the <a class="reference internal" href="perhill.html#perhill"><span class="std std-ref">periodic hill</span></a> example first!
Similarly, we start by generating a 2D mesh, and modify the case files for this instance afterwards and finally run the case.</p>
<section id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this heading">¶</a></h2>
<p>Users must always bear in mind, when setting up a test case in <em>Nek5000</em>, case files will need to be edited.
Some samples can be found in the <code class="docutils literal notranslate"><span class="pre">Nek5000/examples</span></code> directory included with the release version.
Blank template files for the user file, <code class="docutils literal notranslate"><span class="pre">zero.usr</span></code>, and the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file, <code class="docutils literal notranslate"><span class="pre">SIZE.template</span></code>, can be found in the <code class="docutils literal notranslate"><span class="pre">Nek5000/core</span></code> directory.
As a first step, the user should create a case directory in the corresponding run directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd $HOME/Nek5000/run
mkdir conj_ht
cd conj_ht
</pre></div>
</div>
<p>and copy the template files into this directory.
Additionally, this tutorial requires the <code class="docutils literal notranslate"><span class="pre">ray0.rea</span></code> file from the Rayleigh-Bernard example found in <code class="docutils literal notranslate"><span class="pre">Nek5000/examples/rayleigh</span></code>.</p>
<p>We begin by creating the mesh with appropriate bounday conditions and then setting up the parameters and case files.</p>
</section>
<section id="mesh-generation">
<h2>Mesh generation<a class="headerlink" href="#mesh-generation" title="Permalink to this heading">¶</a></h2>
<p>This tutorial requires that you have the tools <code class="docutils literal notranslate"><span class="pre">genbox</span></code>, <code class="docutils literal notranslate"><span class="pre">genmap</span></code>, and <em>preNek</em> compiled.
Note that <em>preNek</em> requires the use of an xterminal.
Make sure the tools directory (typically <code class="docutils literal notranslate"><span class="pre">Nek5000/bin</span></code>) is in your environment PATH.
Before beginning, it is important to understand that there are two types of mesh topology: the “<em>v-mesh</em>” for the velocity and the “<em>t-mesh</em>” which can be used for the temperature and passive scalars.
The <em>v-mesh</em> (fluid subdomain) is always a subset of the <em>t-mesh</em> and the global element ID numbers of the <em>v-mesh</em> must preceed those of the <em>t-mesh</em>.
Therefore, we generate a <em>v-mesh</em> and <em>t-mesh</em> with appropriate BCs separately and later merge both subdomains using the conjugate heat transfer merge option in <em>preNek</em>.
This ensures the proper element ordering.</p>
<p>First, we create the mesh for the fluid part by creating the following input file in any text editor and running <code class="docutils literal notranslate"><span class="pre">genbox</span></code>.
Note that any line beginning with ‘#’ is a comment and is ignored by <code class="docutils literal notranslate"><span class="pre">genbox</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ray0.rea
2        spatial dimension
2        number of fields
#========================================================
#
#    Example of 2D  .box file for fluid. This gives 2 x 1
#    box with 20 x 10 elements
#
#    If nelx (y or z) &lt; 0, then genbox automatically generates the
#    grid spacing in the x (y or z) direction
#    with a geometric ratio given by &quot;ratio&quot;.
#    ( ratio=1 implies uniform spacing )
#
#========================================================
#
Box
-20     -10         nelx,nely,nelz for Box)
0.0    2.0   1.0    x0 x1 ratio
0.0    1.0   1.0    y0 y1 ratio
W  ,W  ,W  ,W  ,    V bc&#39;s  ! NB:  3 characters each !
I  ,I  ,E  ,E  ,    T bc&#39;s  !      You must have 2 spaces!
</pre></div>
</div>
<p>It is worth mentioning that since we are running a 2D case, the input file named <code class="docutils literal notranslate"><span class="pre">ray0.rea</span></code> should be a 2D file, not a 3D file.
In this example, the elements are distributed uniformly in the stream-wise (x) and span-wise (y) directions.
All surfaces of the fluid domain are assumed to be wall boundaries, as indicated by <code class="docutils literal notranslate"><span class="pre">'W</span>&#160; <span class="pre">'</span></code>.
The lateral surfaces of the inner domain and solid walls are assumed to be adiabatic, denoted by <code class="docutils literal notranslate"><span class="pre">'I</span>&#160; <span class="pre">'</span></code>.
The thermal boundary conditions for the upper and lower face should be <code class="docutils literal notranslate"><span class="pre">'E</span>&#160; <span class="pre">'</span></code>, which indicates that they are <em>interior boundaries</em>.
This condition is not mandatory, as any boundary condition set on these faces will be overwritten by <em>preNek</em> when the solid and fluid domains are merged with <em>preNek</em>.
However, it is <strong>HIGHLY RECOMMENDED</strong> to assign any expected interior faces as <code class="docutils literal notranslate"><span class="pre">'E</span>&#160; <span class="pre">'</span></code>, as any unjoined interior boundaries will be caught later by <em>preNek</em>.
This is useful for identifying inconsistencies in mesh generation.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">genbox</span></code> is run, the tool will produce a file named <code class="docutils literal notranslate"><span class="pre">box.rea</span></code> containing mesh, boundary condition, and simulation parameter information, which should be renamed to <code class="docutils literal notranslate"><span class="pre">fluid.rea</span></code>.</p>
<p>In the next step, we create the upper and lower solid parts of finite thickness h=0.2.
The lower domain spans <span class="math notranslate nohighlight">\(y \in [-0.2,0]\)</span> and the upper domain spans <span class="math notranslate nohighlight">\(y \in [1,1.2]\)</span>.</p>
<p><strong>Note:</strong> It is important to keep the <em>number of elements equal in the spanwise direction</em> for different parts.
This is to ensure that all the subdomains are conformal on their interfaces.</p>
<p>Both domains can be generated simultaneously by <code class="docutils literal notranslate"><span class="pre">genbox</span></code> with the following input file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ray0.rea
2        spatial dimension
2        number of fields
#========================================================
#
#    This gives a 2 x 1 box with 20 x 5 elements
#    here used for Rayleigh Benard convection.
#
#    Note that spatial dimension &gt; 0 implies that box.rea
#    will be ascii, requiring the ray0.rea template.
#
#========================================================
#
Box
-20    -5           nelx,nely,nelz for Box)
0.0    2.0   1.0    x0 x1 ratio
-0.2   0.0   1.0    y0 y1 ratio
   ,   ,   ,   ,    V bc&#39;s  ! NB:  3 characters each, in order: -x, +x, -y, +y, (-z, +z)!
I  ,I  ,t  ,E  ,    T bc&#39;s  !      You must have 2 spaces!!
Box
-20    -5           nelx,nely,nelz for Box)
0.0    2.0   1.0    x0 x1 ratio
1.0    1.2   1.0    y0 y1 ratio
   ,   ,   ,   ,    V bc&#39;s  ! NB:  3 characters each, in order: left, right, bottom, top
I  ,I  ,E  ,t  ,    T bc&#39;s  !      You must have 2 spaces!!
</pre></div>
</div>
<p>There are a few things worth notice here.
First, no boundary conditions were given for the velocity.
As the generated mesh corresponds only to the solid domain, any provided BCs will be ignored by <em>Nek5000</em> at runtime and these are left as blank, <code class="docutils literal notranslate"><span class="pre">'</span>&#160;&#160; <span class="pre">'</span></code>, to indicate that the velocity is not defined on the solid mesh.
Second, Dirichlet boundaries, <code class="docutils literal notranslate"><span class="pre">'t</span>&#160; <span class="pre">'</span></code>, are prescribed for the temperature.
These will indicate which faces the <code class="docutils literal notranslate"><span class="pre">userbc</span></code> subroutine is called.
Finally, <code class="docutils literal notranslate"><span class="pre">genbox</span></code> does not perform any consistency checks, so even though the two domains are not connected, it will still produce a mesh file.
The tool will again produce a file named <code class="docutils literal notranslate"><span class="pre">box.rea</span></code> which should be renamed to <code class="docutils literal notranslate"><span class="pre">solid.rea</span></code>.</p>
<p>Then, we can run <em>preNek</em> to merge the fluid and solid subdomains.
<em>preNek</em> can be invoked with either the GUI or text-based interface via the commands <code class="docutils literal notranslate"><span class="pre">prex</span></code> and <code class="docutils literal notranslate"><span class="pre">pretex</span></code> respectively.
While the GUI has more functionality, the text-based interface is useful for scripting.
Note that the GUI is displayed in either case, requiring an X-window.
The only difference is in how commands are input into <em>preNek</em>.
For this case the text-based interface will be used.</p>
<p>It is important to first enter the fluid domain file name and then the solid part.
An example of running <code class="docutils literal notranslate"><span class="pre">pretex</span></code> is shown below, with the expected user input highlighted.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> Choose a Name for This Session:
<span class="hll"> combined
</span>   Beginning Session cht2d
   1 READ PREVIOUS PARAMETERS
   2 TYPE IN  NEW  PARAMETERS
   3 CONJ. HEAT TRANSFER MERGE
 Choose item:
<span class="hll">   3
</span><span class="hll">   3
</span> Enter name of fluid session
<span class="hll">   fluid
</span> Enter name of the solid session
<span class="hll">   solid
</span> Exiting session
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">.rea</span></code> suffix is assumed when specifying files to <em>preNek</em>.
If all goes well, this will produce the <code class="docutils literal notranslate"><span class="pre">combined.rea</span></code> file.
<em>preNek</em> will check for boundary condition consistency before exiting.
If it asks to assign any BCs, something is inconsistent with the box files.</p>
<p>Now, the user needs to run the <code class="docutils literal notranslate"><span class="pre">reatore2</span></code> and <code class="docutils literal notranslate"><span class="pre">genmap</span></code> tools in order to produce the <code class="docutils literal notranslate"><span class="pre">cht2d.re2</span></code> and <code class="docutils literal notranslate"><span class="pre">cht2d.ma2</span></code> binary files respectively.
An example of running <code class="docutils literal notranslate"><span class="pre">reatore2</span></code> is shown, again with expected user input highlighted.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Input .rea name
<span class="hll"> combined
</span>  Input .rea/.re2 output name:
<span class="hll"> cht2d
</span>
 Start converting...

 read:   *** MESH DATA ***
          400          200 2 nelt/nelv/ndim
 read:   ***** CURVED SIDE DATA *****
 read:   ***** BOUNDARY CONDITIONS *****
 read:   ***** FLUID   BOUNDARY CONDITIONS *****
            1          60  Number of bcs
 read:   ***** THERMAL BOUNDARY CONDITIONS *****
            2          80  Number of bcs
  done
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">reatore2</span></code> will produce both a binary mesh file, <code class="docutils literal notranslate"><span class="pre">cht2d.re2</span></code>, and a new rea file, <code class="docutils literal notranslate"><span class="pre">cht2d.rea</span></code>.
The options in the rea file are propagated from the original template, <code class="docutils literal notranslate"><span class="pre">ray0.rea</span></code>, and will override the options we will later set in the par file, so it is recommend to either rename or delete the new rea file.
The produced mesh is shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig:cht_mesh</span></code>.</p>
<figure class="align-center" id="id3">
<span id="fig-cht-mesh"></span><img alt="per_mesh" src="../../_images/mesh.png" />
<figcaption>
<p><span class="caption-text">Modified box mesh graded</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="usr-file">
<h2>usr file<a class="headerlink" href="#usr-file" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../problem_setup/case_files.html#case-files-usr"><span class="std std-ref">user routines</span></a> file implements various subroutines to allow the users to interact with the solver.</p>
<p>To get started we copy the template to our case directory and then we modify its subroutines accordingly.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp $HOME/Nek5000/core/zero.usr cht2d.usr
</pre></div>
</div>
<section id="user-data">
<h3>User Data<a class="headerlink" href="#user-data" title="Permalink to this heading">¶</a></h3>
<p><em>Nek5000</em> provides multiple subroutines useful for providing user data.
These are <code class="docutils literal notranslate"><span class="pre">usrdat</span></code>, <code class="docutils literal notranslate"><span class="pre">usrdat2</span></code>, and <code class="docutils literal notranslate"><span class="pre">usrdat3</span></code> which are all called once at the begining of a run and appear towards the bottom of the template user file.
They are called at different times during initialization and the different use cases for each one can be significant, but for the purposes of this tutorial we focus only on basic input done in <code class="docutils literal notranslate"><span class="pre">usrdat</span></code>.
By specifying the needed user parameters in <code class="docutils literal notranslate"><span class="pre">usrdat</span></code> and providing them in a common block, those parameters can easily be made available to any user subroutine.
The relevant lines describing the common block are highlighted for emphasis.
Note that they will appear in most of the modified subroutines.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">usrdat</span><span class="p">()</span><span class="w">   </span><span class="c">! This routine to modify element vertices</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>

<span class="hll"><span class="w">      </span><span class="kt">real </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>
</span><span class="hll"><span class="w">      </span><span class="k">common</span><span class="w"> </span><span class="o">/</span><span class="n">myparams</span><span class="o">/</span><span class="w"> </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>
</span>
<span class="w">      </span><span class="n">deltaT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5</span><span class="w">  </span><span class="c">!temperature change across solid domain</span>
<span class="w">      </span><span class="n">hs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="w">      </span><span class="c">!thickness of solid domain</span>
<span class="w">      </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0</span><span class="w"> </span><span class="c">!ratio of solid to fluid conductivity</span>

<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
</pre></div>
</div>
</section>
<section id="variable-properties">
<h3>Variable properties<a class="headerlink" href="#variable-properties" title="Permalink to this heading">¶</a></h3>
<p>In the <a class="reference internal" href="../problem_setup/case_files.html#case-files-uservp"><span class="std std-ref">uservp subroutine</span></a>, users can specifiy different variable properties for the fluid and solid subdomains independently.
As an example, the thermal diffusivity of Copper is <span class="math notranslate nohighlight">\(\alpha = 1.1 (10 ^ {-4})\)</span> [<span class="math notranslate nohighlight">\(m^{2}/s\)</span>].
The thermal diffusivity ratio of Copper and liquid metal alloy GaInSn (Pr = 0.033) is 10 and the thermal diffusivity ratio of Copper and air (Pr = 0.7) is 5.2 <a class="reference internal" href="../references.html#foroozani2021" id="id2"><span>[Foroozani2021]</span></a>.
The conductivity of the solid region is set by comparing the global element number, <code class="docutils literal notranslate"><span class="pre">eg</span></code>, to the the total number of elements in the <em>v-mesh</em>, <code class="docutils literal notranslate"><span class="pre">nelgv</span></code>.
The highlighted line indicates where this is done:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">uservp</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set variable properties</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="w">      </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">,</span><span class="n">e</span>
<span class="w">      </span><span class="kt">real </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>
<span class="w">      </span><span class="k">common</span><span class="w"> </span><span class="o">/</span><span class="n">myparams</span><span class="o">/</span><span class="w"> </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>

<span class="c">!     e = gllel(eg)</span>

<span class="w">      </span><span class="n">udiff</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">cpfld</span><span class="p">(</span><span class="n">ifield</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="n">utrans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpfld</span><span class="p">(</span><span class="n">ifield</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="hll"><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">eg</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">nelgv</span><span class="p">)</span><span class="w"> </span><span class="n">udiff</span><span class="o">=</span><span class="n">lambda</span><span class="o">*</span><span class="n">cpfld</span><span class="p">(</span><span class="n">ifield</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
</pre></div>
</div>
<p>Note that the properties only vary between the fluid and the solid subdomains.
Properties with the fluid and solid respectively remain constant as provided by the <code class="docutils literal notranslate"><span class="pre">cpfld</span></code> array.
The <code class="docutils literal notranslate"><span class="pre">cpfld</span></code> array is filled with the values assigned in the par file according to:</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">The field coefficient array</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter in the par file</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>viscosity</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cpfld(1,1)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>density</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cpfld(1,2)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>conductivity</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cpfld(2,1)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>rhoCp</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cpfld(2,2)</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="buoyancy-model">
<h3>Buoyancy model<a class="headerlink" href="#buoyancy-model" title="Permalink to this heading">¶</a></h3>
<p>To account for buoyancy, the Buossinesq approximation is used.
Rather than explicitly including a variable density, a body force of the form <span class="math notranslate nohighlight">\(F = \rho g \beta (T-T_{ref})\)</span> is included.
Due to the choice of non-dimensionalization, this is implemented here simply as <span class="math notranslate nohighlight">\(F = T\)</span>.
A body force is added to <em>Nek5000</em> in the <code class="docutils literal notranslate"><span class="pre">userf</span></code> subroutine, which is seen below.
The highlighted line indicates where the buoyancy force is added in the <em>y</em>-direction.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">userf</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set acceleration term</span>
<span class="c">!</span>
<span class="c">!     Note: this is an acceleration term, NOT a force!</span>
<span class="c">!     Thus, ffx will subsequently be multiplied by rho(x,t).</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="w">      </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">,</span><span class="n">e</span>
<span class="c">!     e = gllel(eg)</span>

<span class="w">      </span><span class="n">ffx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="hll"><span class="w">      </span><span class="n">ffy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
</span><span class="w">      </span><span class="n">ffz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
</pre></div>
</div>
<p>In this study, the volumetric heat source is set to be zero, <code class="docutils literal notranslate"><span class="pre">qvol</span> <span class="pre">=</span> <span class="pre">0</span></code>, in the <em>t-mesh</em> which is the default behavior in the <code class="docutils literal notranslate"><span class="pre">userq</span></code> subroutine.
So no modification to <code class="docutils literal notranslate"><span class="pre">userq</span></code> is necessary.</p>
</section>
<section id="initial-boundary-conditions">
<h3>Initial &amp; boundary conditions<a class="headerlink" href="#initial-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>The next step is to specify the initial and boundary conditions.
We apply a linear variation of temperature in the fluid mesh in the <em>y</em>-direction where the lower surface of the lower plate is maintained at a high temperature, and the upper surface of the upper plate is maintained at a low temperature.</p>
<p>In this RBC example <span class="math notranslate nohighlight">\(Ra = 10 ^ {7}\)</span> and <span class="math notranslate nohighlight">\(Pr= 0.033\)</span> are choosen.
The equilibrium state of pure conductive heat transfer as the initial condition takes the form <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">=</span> <span class="pre">1</span> <span class="pre">-</span> <span class="pre">y</span></code> for  <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">y</span> <span class="pre">&lt;</span> <span class="pre">1</span></code>  in the fluid domain and <span class="math notranslate nohighlight">\(T \approx 1\)</span> and <span class="math notranslate nohighlight">\(\approx 0\)</span> at the fluid-solid boundaries.
It should be mentioned that the temperature drop across both solid-plates varies with <em>Pr</em> and <em>Ra</em> and it should be adjusted at the boundaries with temperature increment <span class="math notranslate nohighlight">\(\delta T\)</span>.
One can apply a temperature increment of <span class="math notranslate nohighlight">\(\delta T = 2.5\)</span> at the top of the upper plate and the bottom of the lower plate for <em>Pr = 0.033</em> and <span class="math notranslate nohighlight">\(\delta T = 4.72\)</span> for <em>Pr = 0.7</em> as depicted in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig:deltaT2</span></code>.
Subsequently, we modify <code class="docutils literal notranslate"><span class="pre">userbc</span></code> and <code class="docutils literal notranslate"><span class="pre">useric</span></code> as:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">userbc</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set up boundary conditions</span>
<span class="c">!</span>
<span class="c">!     NOTE ::: This subroutine MAY NOT be called by every process</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="w">      </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">eg</span>
<span class="w">      </span><span class="kt">real </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>
<span class="w">      </span><span class="k">common</span><span class="w"> </span><span class="o">/</span><span class="n">myparams</span><span class="o">/</span><span class="w"> </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>

<span class="c">!      if (cbc(iside,gllel(eg),ifield).eq.&#39;v01&#39;)</span>

<span class="w">      </span><span class="n">ux</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="hll"><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=-</span><span class="n">deltaT</span><span class="w"> </span><span class="c">!top plate</span>
</span><span class="hll"><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deltaT</span><span class="w"> </span><span class="c">!bottom plate</span>
</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">useric</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span><span class="w"> </span><span class="c">! set up initial conditions</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;NEKUSE&#39;</span>

<span class="w">      </span><span class="kt">integer </span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">iz</span><span class="p">,</span><span class="n">eg</span>
<span class="w">      </span><span class="kt">real </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>
<span class="w">      </span><span class="k">common</span><span class="w"> </span><span class="o">/</span><span class="n">myparams</span><span class="o">/</span><span class="w"> </span><span class="n">deltaT</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">lambda</span>

<span class="w">      </span><span class="n">ux</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">      </span><span class="n">uz</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="hll"><span class="w">      </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="c">!fluid temperature</span>
</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="hll"><span class="k">        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">hs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaT</span><span class="w"> </span><span class="c">!top plate</span>
</span><span class="w">      </span><span class="n">elseif</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="hll"><span class="k">        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">hs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaT</span><span class="w"> </span><span class="c">!bottom plate</span>
</span><span class="w">      </span><span class="k">endif</span>

<span class="k">      return</span>
<span class="k">      end</span>
</pre></div>
</div>
<figure class="align-center" id="id5">
<span id="fig-deltat2"></span><img alt="per_flow" src="../../_images/deltaT2.png" />
<figcaption>
<p><span class="caption-text">Mean dimensionless temperature profiles in the CHT setting. Temprerature variation in solid-fluid domain is shown here.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="control-parameters">
<h2>Control parameters<a class="headerlink" href="#control-parameters" title="Permalink to this heading">¶</a></h2>
<p>The control parameters for any case are given in the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file.
For this case, using any text editor, create a new file called <code class="docutils literal notranslate"><span class="pre">cht2d.par</span></code> and type in the following:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nek5000 parameter file</span>
<span class="k">[GENERAL]</span>
<span class="na">stopAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">endTime</span>
<span class="na">endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">50</span>
<span class="na">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5.0e-1</span>
<span class="na">variabledt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span>
<span class="na">targetCFL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.5</span>
<span class="na">writeControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">runTime</span>
<span class="na">writeInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.0</span>

<span class="k">[VELOCITY]</span>
<span class="na">density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.0</span>
<span class="na">viscosity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5.744563e-5</span>

<span class="k">[TEMPERATURE]</span>
<span class="na">conjugateHeatTransfer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span>
<span class="na">rhoCp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.0</span>
<span class="na">conductivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.740776e-3</span>
</pre></div>
</div>
<p>Note that if the file <code class="docutils literal notranslate"><span class="pre">cht2d.rea</span></code> exists within the case directory, <em>Nek5000</em> will preferentially read the case parameters from that file instead, which may result in errors or inconsistent results.
In this example, we have set the calculation to stop after a physical time of 50 (<code class="docutils literal notranslate"><span class="pre">endTime</span> <span class="pre">=</span> <span class="pre">50.0</span></code>) and write the checkpoint file every 1 physical time units (<code class="docutils literal notranslate"><span class="pre">writeInterval</span> <span class="pre">=</span> <span class="pre">1.0</span></code>).
This will provide 50 snapshots of the developing velocity and temperature fields.
In choosing <code class="docutils literal notranslate"><span class="pre">viscosity</span> <span class="pre">=</span> <span class="pre">5.744563E-05</span></code> and <code class="docutils literal notranslate"><span class="pre">conductivity</span> <span class="pre">=</span> <span class="pre">1.740776E-03</span></code>, actually we are setting the Rayleigh <em>Ra=10e7</em> and <em>Pr=0.033</em>.
By omitting the <code class="docutils literal notranslate"><span class="pre">[PRESSURE]</span></code> and <code class="docutils literal notranslate"><span class="pre">[PROBLEMTYPE]</span></code> categories, we are telling the solver to use default values for the necessary parameters.
Additional details on available settings in the par file are available <a class="reference internal" href="../problem_setup/case_files.html#case-files-par"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="size-file">
<h2>SIZE file<a class="headerlink" href="#size-file" title="Permalink to this heading">¶</a></h2>
<p>The static memory layout of <em>Nek5000</em> requires the user to set some solver parameters through a so called <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file.
Typically it’s a good idea to start from the template.
If you haven’t already, copy the <code class="docutils literal notranslate"><span class="pre">SIZE.template</span></code> file from the core directory and rename it <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> in the working directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cp $HOME/Nek5000/core/SIZE.template SIZE
</pre></div>
</div>
<p>Then, adjust the following parameters in the BASIC section.
The only one you will likely need to change is the number of global elements on the highlighted line.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="c">! BASIC</span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">ldim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w">               </span><span class="c">! domain dimension (2 or 3)</span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lx1</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="w">                </span><span class="c">! GLL points per element along each direction</span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lxd</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="w">               </span><span class="c">! GL  points for over-integration (dealiasing) </span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lx2</span><span class="o">=</span><span class="n">lx1</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="w">            </span><span class="c">! GLL points for pressure (lx1 or lx1-2)</span>
<span class="w">                                     </span>
<span class="hll"><span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lelg</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span><span class="w">             </span><span class="c">! max number of global elements</span>
</span><span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lpmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w">              </span><span class="c">! min number of MPI ranks </span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">lelt</span><span class="o">=</span><span class="n">lelg</span><span class="o">/</span><span class="n">lpmin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="c">! max number of local elements per MPI rank</span>
<span class="w">      </span><span class="k">parameter</span><span class="w"> </span><span class="p">(</span><span class="n">ldimt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w">              </span><span class="c">! max auxiliary fields (temperature + scalars)</span>
</pre></div>
</div>
<p>For this tutorial we have set our polynomial order to be <span class="math notranslate nohighlight">\(N=7\)</span> - this is defined in the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file above as <code class="docutils literal notranslate"><span class="pre">lx1=8</span></code> which indices that there are 8 points in each spatial dimension of every element.
Additional details on the parameters in the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file are given <a class="reference internal" href="../problem_setup/case_files.html#case-files-size"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this heading">¶</a></h2>
<p>You should now be all set to compile and run your case!
As a final check, you should have the following files:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference download internal" download="" href="../../_downloads/db626f07aeca29a800a2918cfd84b0de/cht2d.usr"><code class="xref download docutils literal notranslate"><span class="pre">cht2d.usr</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../../_downloads/3fcfb9b69a005c0bda167b2ef8cce9a8/cht2d.par"><code class="xref download docutils literal notranslate"><span class="pre">cht2d.par</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../../_downloads/45a13ea9b3ac2b6265f2fa0d1b546141/cht2d.re2"><code class="xref download docutils literal notranslate"><span class="pre">cht2d.re2</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../../_downloads/8e7a0be61bb3a625e236059fdab282bd/cht2d.ma2"><code class="xref download docutils literal notranslate"><span class="pre">cht2d.ma2</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../../_downloads/934e3e93ce5f414dca7ee978ef4968d5/SIZE"><code class="xref download docutils literal notranslate"><span class="pre">SIZE</span></code></a></p></li>
</ul>
</div></blockquote>
<p>If for some reason you encountered an insurmountable error and were unable to generate any of the required files, you may use the provided links to download them.
After confirming that you have all five, you are now ready to compile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">makenek</span> <span class="n">cht2d</span>
</pre></div>
</div>
<p>If all works properly, upon compilation the executable <code class="docutils literal notranslate"><span class="pre">nek5000</span></code> will be generated and you will see something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#############################################################
#                  Compilation successful!                  #
#############################################################
   text	   data	    bss	    dec	    hex	filename
1774311	  16940	141305600	143096851	8877c13	nek5000
</pre></div>
</div>
<p>Note that compilation only relies on the user file and the SIZE file.
Any changes to these two files will require recompiling your case!
Now you are all set, just run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nekbmpi<span class="w"> </span>cht2d<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<p>to launch an MPI jobs on your local machine using 4 ranks. The output will be redirected to <code class="docutils literal notranslate"><span class="pre">logfile</span></code>.</p>
</section>
<section id="post-processing-the-results">
<h2>Post-processing the results<a class="headerlink" href="#post-processing-the-results" title="Permalink to this heading">¶</a></h2>
<p>Once execution is completed your directory should now contain multiple checkpoint files that look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cht2d</span><span class="o">.</span><span class="n">f00001</span>
<span class="n">cht2d</span><span class="o">.</span><span class="n">f00002</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The preferred mode for data visualization and analysis with <em>Nek5000</em> is
to use Visit/Paraview. One can use the script <em>visnek</em>, to be found in <code class="docutils literal notranslate"><span class="pre">/scripts</span></code>. It is sufficent to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">visnek</span> <span class="n">cht2d</span>
</pre></div>
</div>
<p><em>(or the name of your session)</em> to obtain a file named <code class="docutils literal notranslate"><span class="pre">cht2d.nek5000</span></code> which can be recognized in Visit/Paraview.</p>
<p>In the viewing window, one can visualize the temperature-field.
It will be similar to, but not necessarily identical to that shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig:cht_rbc</span></code>.</p>
<figure class="align-center" id="id6">
<span id="fig-cht-rbc"></span><img alt="per_flow" src="../../_images/cht_rbc.png" />
<figcaption>
<p><span class="caption-text">Steady-State flow field visualized in Visit/Paraview. Vectors represent velocity. Colors represent velocity magnitude.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Ricardo Frantz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: main
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
        
           <strong> 
          <dd><a href="/nekStabDoc/en/main/">en</a></dd>
           </strong> 
        
          
          <dd><a href="/nekStabDoc/es/main/">es</a></dd>
          
        
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
           <strong> 
          <dd><a href="/nekStabDoc/en/main/">main</a></dd>
           </strong> 
        
      </dl>
      
      
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="/nekStabDoc/en/main/nekStab-docs_en_main.pdf">pdf</a></dd>
        
          <dd><a href="/nekStabDoc/en/main/nekStab-docs_en_main.epub">epub</a></dd>
        
      </dl>
      
      
      <hr/>
      <a href="https://tech.michaelaltfield.net/2020/07/18/sphinx-rtd-github-pages-1/">Continuous Documentation</a> hosting provided by <a href="https://pages.github.com/">GitHub Pages</a>.
 
    </div>
  </div>

 

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>